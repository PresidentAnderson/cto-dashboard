# Cron Jobs Environment Variables - CTO Dashboard v2.0
# Copy this file to .env.local and fill in the values

# ============================================================================
# REQUIRED VARIABLES
# ============================================================================

# Database connection string
# Format: postgresql://user:password@host:5432/database?schema=public
DATABASE_URL=postgresql://user:password@localhost:5432/cto_dashboard

# Cron job authentication secret
# Generate with: openssl rand -base64 32
# This must match between your local .env and Vercel environment variables
CRON_SECRET=your-secure-random-secret-here

# ============================================================================
# OPTIONAL VARIABLES
# ============================================================================

# Email Configuration
# ---------------------

# Comma-separated list of email addresses to receive weekly reports
REPORT_EMAILS=cto@company.com,engineering@company.com

# Sender email address for reports
EMAIL_FROM=cto-dashboard@company.com

# Email Service API Keys (choose one)
# ---------------------

# Option 1: Resend (recommended)
# Get API key from: https://resend.com
RESEND_API_KEY=re_xxxxxxxxxxxxx

# Option 2: SendGrid
# Get API key from: https://sendgrid.com
SENDGRID_API_KEY=SG.xxxxxxxxxxxxx

# Option 3: AWS SES
# Configure AWS credentials for SES
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1

# Testing & Development
# ---------------------

# Base URL for API endpoints (default: http://localhost:3000)
BASE_URL=http://localhost:3000

# Node environment (development, production)
NODE_ENV=development

# Enable detailed logging
DEBUG=true

# ============================================================================
# CRON JOB CONFIGURATION
# ============================================================================

# Alert Thresholds
# ---------------------

# Revenue at risk threshold for alerts (in dollars)
REVENUE_ALERT_THRESHOLD=10000

# Number of consecutive job failures before alerting
FAILURE_THRESHOLD=3

# Job execution time threshold for slow job alerts (in milliseconds)
SLOW_JOB_THRESHOLD=300000

# Data Retention
# ---------------------

# Number of sync events to keep in database
SYNC_EVENTS_RETENTION=10000

# Number of job history records to keep
JOB_HISTORY_RETENTION=1000

# Number of days to keep import logs
IMPORT_LOGS_RETENTION_DAYS=90

# GitHub Integration
# ---------------------

# GitHub personal access token for API access
GITHUB_TOKEN=ghp_xxxxxxxxxxxxx

# GitHub organization name
GITHUB_ORG=your-organization

# Rate limiting
GITHUB_API_RATE_LIMIT=5000

# ============================================================================
# NOTES
# ============================================================================

# 1. CRON_SECRET Security
#    - Generate a strong random secret: openssl rand -base64 32
#    - Never commit the actual secret to git
#    - Use different secrets for development and production
#    - Store production secret in Vercel environment variables

# 2. Database Connection
#    - Ensure DATABASE_URL includes SSL settings for production
#    - Connection pooling is handled by Prisma (max 10 connections)
#    - Use read replicas for heavy read operations if available

# 3. Email Service Setup
#    - Only configure one email service (Resend recommended)
#    - Verify sender domain for production use
#    - Test email delivery before enabling weekly reports
#    - Monitor email bounce rates and deliverability

# 4. Vercel Deployment
#    - Set all required variables in Vercel dashboard
#    - Use Environment Variables section under Project Settings
#    - Set appropriate scope (Production, Preview, Development)
#    - Test with preview deployments before production

# 5. Testing Locally
#    - Use test-cron-jobs.sh script for manual testing
#    - Ensure server is running before testing
#    - Check logs for detailed error messages
#    - Monitor database during test runs

# 6. Monitoring
#    - Check job_history table for execution records
#    - Monitor sync_events table for detailed logs
#    - Set up alerts for critical failures
#    - Review weekly reports for system health

# ============================================================================
# VERCEL ENVIRONMENT VARIABLES SETUP
# ============================================================================

# To set variables in Vercel:
# 1. Go to your project in Vercel dashboard
# 2. Navigate to Settings > Environment Variables
# 3. Add each required variable:
#    - DATABASE_URL (Production, Preview, Development)
#    - CRON_SECRET (Production, Preview, Development)
#    - REPORT_EMAILS (Production only)
#    - EMAIL_FROM (Production only)
#    - RESEND_API_KEY (Production only)

# Or use Vercel CLI:
# vercel env add DATABASE_URL
# vercel env add CRON_SECRET
# vercel env add REPORT_EMAILS

# ============================================================================
# QUICK START
# ============================================================================

# 1. Copy this file:
#    cp .env.cron.example .env.local

# 2. Generate CRON_SECRET:
#    openssl rand -base64 32

# 3. Update DATABASE_URL with your database credentials

# 4. Test locally:
#    ./test-cron-jobs.sh all

# 5. Deploy to Vercel:
#    vercel --prod

# 6. Verify cron jobs in Vercel dashboard:
#    https://vercel.com/[your-team]/[your-project]/settings/cron-jobs
